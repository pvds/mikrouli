<script>
import { base } from "$app/paths";
import ContentSection from "$layout/ContentSection.svelte";
import Hero from "$layout/Hero.svelte";
import Section from "$layout/Section.svelte";
import { getImageName } from "$lib/helpers/image";
import Image from "$ui/image/Image.svelte";

let { data } = $props();
let { header, intro, slug, sections } = data.page.fields; // Destructure `posts` from `local`
let posts = data.posts;
</script>

<Hero title={header}>
	{@html intro}
</Hero>

<!--TODO: Decide whether to add content sections-->
<!--{#each sections as section}-->
<!--	<ContentSection prose size="sm">-->
<!--		{@html section}-->
<!--	</ContentSection>-->
<!--{/each}-->

{#each posts as post, i}
	<Section wave={i % 2 === 1}>
		{@render teaser(post.fields, i)}
	</Section>
{/each}

{#snippet teaser(
	/** @type {import("$types/contentful").PostFields } */ post,
	/** @type {number} */ i
)}
	<article
	   class="group relative flex flex-wrap items-center gap-4">
		{#if post.heroImage}
			<div class="flex-none min-w-[20rem]">
				<Image
					image={getImageName(post.heroImage.file.fileName)}
					alt={post.heroImage.description}
					sizes="20rem"
					priority={(i <= 1)}
					classes="rounded-md not-group-hover:grayscale"
					isCMS={true}
				/>
			</div>
		{/if}
		<div style="view-transition-name: {post.slug}">
			<h2 class="mb-4 text-3xl font-bold">{post.title}</h2>
			<div class="prose prose-base">{@html post.intro}</div>
			<a href={`${base}/${slug}/${post.slug}`}
				class="inline-block mt-4 font-semibold transition-all hover:underline group-hover:text-accent-dark after:content[''] after:absolute after:inset-0">Read more
				<span class="inline-block group-hover:animate-wiggle-right">â†’</span>
			</a>
		</div>
	</article>
{/snippet}
